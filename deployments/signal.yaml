apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: signal
  name: signal
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: signal
      name: signal
    spec:
      containers:
        - name: signal
          image: gcr.io/cpe-data/tsignal:latest
          imagePullPolicy: Always
          env:
            - name: T_CONSUMER_KEY
              valueFrom:
                secretKeyRef:
                  name: signal-tw-key
                  key: T_CONSUMER_KEY
            - name: T_CONSUMER_SECRET
              valueFrom:
                secretKeyRef:
                  name: signal-tw-secret
                  key: T_CONSUMER_SECRET
            - name: T_ACCESS_TOKEN
              valueFrom:
                secretKeyRef:
                  name: signal-tw-token
                  key: T_ACCESS_TOKEN
            - name: T_ACCESS_SECRET
              valueFrom:
                secretKeyRef:
                  name: signal-tw-access
                  key: T_ACCESS_SECRET
            - name: GCLOUD_PROJECT
              valueFrom:
                secretKeyRef:
                  name: signal-gcloud-project
                  key: GCLOUD_PROJECT
            - name: GCLOUD_INSTANCE
              valueFrom:
                secretKeyRef:
                  name: signal-spanner-instance
                  key: GCLOUD_INSTANCE
            - name: GCLOUD_DB
              valueFrom:
                secretKeyRef:
                  name: signal-spanner-db
                  key: GCLOUD_DB
          volumeMounts:
            - name: "service-account"
              mountPath: "/var/run/secret/cloud.google.com"
            - name: "certs"
              mountPath: "/etc/ssl/certs"
      volumes:
        - name: "service-account"
          secret:
            secretName: "signal-sa"
        - name: "certs"
          hostPath:
            path: "/etc/ssl/certs"
